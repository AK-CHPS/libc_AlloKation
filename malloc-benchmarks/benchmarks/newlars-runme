#!/bin/sh
#
#  run a series of malloc tests
#

MALLOC_TEST="/usr/bin/time ./newlars"
BLKSIZE=40
BLOCKS=10000
RUNS="1 2 3 4 5"
ROUNDS="10 20 30 40 50 60 70 80"

/bin/uname -a
/usr/bin/uptime
echo " "

echo "*** Test 1.  pthread_create overhead"
echo " "

for ROUND in $ROUNDS
do
  for RUN in $RUNS
  do
    $MALLOC_TEST $BLKSIZE 1 $BLOCKS $ROUND
  done
done

echo "*** Done with Test 1."
echo " "
echo " "

echo "*** Test 2.  Block leak test"
echo " "

for ROUND in $ROUNDS
do
  for RUN in $RUNS
  do
    $MALLOC_TEST $BLKSIZE 7 $BLOCKS $ROUND
  done
done

echo "*** Done with Test 2."
echo " "
echo " "

echo "*** Test 3.  Block leak test with more threads"
echo " "

for ROUND in $ROUNDS
do
  for RUN in $RUNS
  do
    $MALLOC_TEST $BLKSIZE 13 $BLOCKS $ROUND
  done
done

echo "*** Done with Test 3."
echo " "
echo " "
/usr/bin/uptime
echo " "

exit 0
