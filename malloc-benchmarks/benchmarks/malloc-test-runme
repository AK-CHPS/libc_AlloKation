#!/bin/sh
#
#  run a series of malloc tests
#

MALLOC_TEST="./malloc-test"
REQUESTS=10000000

/bin/uname -a
/usr/bin/uptime
echo " "

echo "*** Test 1.  Basic single thread malloc performance"
echo " "
for i in 1 2 3 4 5
do
  $MALLOC_TEST 512 $REQUESTS 1
  echo " "
done
echo "*** Done with Test 1."
echo " "
echo " "

echo "*** Test 2.  Two-thread v. Two-process performance"
echo " "
for i in 1 2 3
do
  $MALLOC_TEST 512 $REQUESTS 2
  echo " "
done

for i in 1 2 3
do
  $MALLOC_TEST 512 $REQUESTS 1 &
  $MALLOC_TEST 512 $REQUESTS 1 &
  wait
  echo " "
done
echo "*** Done with Test 2."
echo " "
echo " "

echo "*** Test 3.  Thread scalability"
echo " "
for j in 1 2 3 4 5
do
  for i in 1 2 3 4 5
  do
    $MALLOC_TEST 8192 $REQUESTS $j
  done
  echo " "
done
echo "*** Done with Test 3."
echo " "

/usr/bin/uptime
echo " "

exit 0
